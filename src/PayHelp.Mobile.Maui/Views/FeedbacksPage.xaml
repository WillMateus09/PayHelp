<?xml version="1.0" encoding="UTF-8"?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:vm="clr-namespace:PayHelp.Mobile.Maui.ViewModels"
             xmlns:utils="clr-namespace:PayHelp.Mobile.Maui.Utilities"
             x:Class="PayHelp.Mobile.Maui.Views.FeedbacksPage"
             Title="Feedbacks">
    <Grid RowDefinitions="Auto,*" Padding="20">
        <VerticalStackLayout Grid.Row="0" Spacing="16">
            <Label Text="Feedbacks de UsuÃ¡rios" Style="{StaticResource H2}" />

            <!-- Filtros -->
            <Frame Style="{StaticResource Card}">
                <Grid ColumnDefinitions="*,*" RowDefinitions="Auto,Auto" ColumnSpacing="12" RowSpacing="12">
                    <VerticalStackLayout Grid.Column="0" Spacing="4">
                        <Label Text="De" Style="{StaticResource Caption}"/>
                        <DatePicker Date="{Binding DataInicio}" />
                    </VerticalStackLayout>
                    <VerticalStackLayout Grid.Column="1" Spacing="4">
                        <Label Text="AtÃ©" Style="{StaticResource Caption}"/>
                        <DatePicker Date="{Binding DataFim}" />
                    </VerticalStackLayout>
                    <Button Grid.Row="1" Grid.ColumnSpan="2"
                            Text="Aplicar"
                            Style="{StaticResource SmallButton}"
                            Command="{Binding CarregarCommand}" />
                </Grid>
            </Frame>
        </VerticalStackLayout>

        <!-- Lista completa de feedbacks -->
        <CollectionView Grid.Row="1"
                        ItemsSource="{Binding Feedbacks}"
                        VerticalOptions="FillAndExpand"
                        ItemsLayout="VerticalList"
                SelectionMode="Single"
                SelectionChanged="OnSelecionado"
                x:Name="FeedbacksCollection">
            <CollectionView.ItemTemplate>
                <DataTemplate>
                    <Frame Style="{StaticResource Card}" Margin="0,0,0,12">
                        <VerticalStackLayout Spacing="10">
                            <!-- CabeÃ§alho usuÃ¡rio + nota -->
                            <Grid ColumnDefinitions="*,Auto" ColumnSpacing="8">
                                <VerticalStackLayout>
                                    <Label Text="{Binding UsuarioNome}" Style="{StaticResource Body}" FontAttributes="Bold"/>
                                    <Label Text="{Binding UsuarioEmail}" Style="{StaticResource Caption}" TextColor="{StaticResource Gray600}"/>
                                    <Label Text="{Binding TicketTitulo}" Style="{StaticResource Caption}"/>
                                </VerticalStackLayout>
                                <VerticalStackLayout Grid.Column="1" Spacing="2" HorizontalOptions="End">
                                    <Label Text="{Binding Nota, StringFormat='â­ {0}'}" FontSize="18" FontAttributes="Bold"/>
                                    <Label Text="{Binding DataCriacaoUtc, StringFormat='{0:dd/MM/yyyy HH:mm}'}" Style="{StaticResource Caption}" HorizontalOptions="End"/>
                                </VerticalStackLayout>
                            </Grid>
                            <!-- ComentÃ¡rio -->
                            <Grid ColumnDefinitions="Auto,*" ColumnSpacing="8">
                                <Label Text="ðŸ’¬" FontSize="18" VerticalOptions="Start"/>
                                <Label Grid.Column="1" Text="{Binding Comentario}" Style="{StaticResource Body}" LineBreakMode="WordWrap"/>
                            </Grid>
                        </VerticalStackLayout>
                    </Frame>
                </DataTemplate>
            </CollectionView.ItemTemplate>
            <CollectionView.EmptyView>
                <VerticalStackLayout Spacing="16" 
                                   Padding="40" 
                                   HorizontalOptions="Center" 
                                   VerticalOptions="Center">
                    <Label Text="ðŸ“­" 
                           FontSize="64"
                           HorizontalOptions="Center"/>
                    <Label Text="Nenhum feedback recebido ainda" 
                           Style="{StaticResource Body}"
                           FontAttributes="Bold"
                           HorizontalOptions="Center"/>
                    <Label Text="Os feedbacks dos usuÃ¡rios aparecerÃ£o aqui" 
                           Style="{StaticResource Caption}"
                           HorizontalTextAlignment="Center"/>
                </VerticalStackLayout>
            </CollectionView.EmptyView>
        </CollectionView>
    </Grid>
</ContentPage>
